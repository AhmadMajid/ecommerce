<% content_for(:title, "Products") %>
<% content_for(:description, "Browse our wide selection of high-quality products") %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Page Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">
      <% if @current_category %>
        <%= @current_category.name %>
      <% else %>
        All Products
      <% end %>
    </h1>

    <% if @current_category&.description.present? %>
      <p class="text-gray-600"><%= @current_category.description %></p>
    <% end %>

    <!-- Breadcrumb -->
    <nav class="mt-4">
      <ol class="flex items-center space-x-2 text-sm text-gray-500">
        <li><%= link_to "Home", root_path, class: "hover:text-gray-700" %></li>
        <li><span class="mx-2">/</span></li>
        <% if @current_category %>
          <% @current_category.breadcrumbs.each_with_index do |category, index| %>
            <% if index == @current_category.breadcrumbs.length - 1 %>
              <li class="text-gray-900 font-medium"><%= category.name %></li>
            <% else %>
              <li>
                <%= link_to category.name, category_path(category), class: "hover:text-gray-700" %>
                <span class="mx-2">/</span>
              </li>
            <% end %>
          <% end %>
        <% else %>
          <li class="text-gray-900 font-medium">Products</li>
        <% end %>
      </ol>
    </nav>
  </div>

  <div class="flex flex-col lg:flex-row gap-8">
    <!-- Sidebar Filters -->
    <div class="w-full lg:w-64 flex-shrink-0">
      <div class="bg-white rounded-lg shadow-sm p-6">

        <!-- Search -->
        <%= form_with url: products_path,
            method: :get,
            local: true,
            class: "space-y-6" do |form| %>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
            <%= form.text_field :search,
                value: params[:search],
                placeholder: "Search products...",
                class: "form-input w-full" %>
          </div>

          <!-- Category Filter -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
            <%= form.select :category_id,
                options_for_select([['All Categories', '']] + simple_hierarchical_category_options, params[:category_id]),
                {},
                { class: "form-select w-full" } %>
          </div>

          <!-- Price Range -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Price Range</label>
            <div class="flex items-center space-x-2">
              <%= form.number_field :min_price,
                  value: params[:min_price],
                  placeholder: "Min",
                  step: 0.01,
                  class: "form-input w-full" %>
              <span class="text-gray-500">to</span>
              <%= form.number_field :max_price,
                  value: params[:max_price],
                  placeholder: "Max",
                  step: 0.01,
                  class: "form-input w-full" %>
            </div>
          </div>

          <!-- Filter Button -->
          <div class="flex space-x-2">
            <%= form.submit "Filter", class: "btn btn-primary flex-1" %>
            <%= link_to "Clear", products_path, class: "btn btn-outline-secondary" %>
          </div>

          <!-- Preserve current sort -->
          <%= form.hidden_field :sort, value: params[:sort] %>

        <% end %>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1">
      <!-- Toolbar -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 bg-white rounded-lg shadow-sm p-4">
        <!-- Results Count -->
        <div class="mb-4 sm:mb-0">
          <p class="text-sm text-gray-600">
            Showing <%= @products.offset_value + 1 %>-<%= [@products.offset_value + @products.limit_value, @products.total_count].min %>
            of <%= @products.total_count %> products
          </p>
        </div>

        <!-- Sort Options -->
        <div class="flex items-center space-x-4">
          <label class="text-sm font-medium text-gray-700">Sort by:</label>
          <%= form_with url: products_path,
              method: :get,
              local: true,
              data: { remote: true },
              class: "inline" do |form| %>
            <%= form.select :sort,
                options_for_select([
                  ['Default', ''],
                  ['Price: Low to High', 'price_low'],
                  ['Price: High to Low', 'price_high'],
                  ['Rating: High to Low', 'rating_high'],
                  ['Rating: Low to High', 'rating_low'],
                  ['Name A-Z', 'name'],
                  ['Newest First', 'newest'],
                  ['Featured', 'featured']
                ], params[:sort]),
                {},
                {
                  class: "form-select",
                  onchange: "this.form.submit()"
                } %>

            <!-- Preserve current filters -->
            <%= form.hidden_field :search, value: params[:search] %>
            <%= form.hidden_field :category_id, value: params[:category_id] %>
            <%= form.hidden_field :min_price, value: params[:min_price] %>
            <%= form.hidden_field :max_price, value: params[:max_price] %>
          <% end %>
        </div>
      </div>

      <!-- Products Grid -->
      <div id="products-container">
        <%= render 'products_grid', products: @products %>
      </div>
    </div>
  </div>
</div>
