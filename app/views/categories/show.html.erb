<% content_for(:title, @category.name) %>
<% content_for(:description, @category.description.presence || "Browse #{@category.name} products") %>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- Category Header -->
  <div class="mb-8">
    <!-- Breadcrumb -->
    <nav class="mb-4">
      <ol class="flex items-center space-x-2 text-sm text-gray-500">
        <li><%= link_to "Home", root_path, class: "hover:text-gray-700" %></li>
        <li><span class="mx-2">/</span></li>
        <li><%= link_to "Categories", categories_path, class: "hover:text-gray-700" %></li>
        <% @category.breadcrumbs[0..-2].each do |category| %>
          <li><span class="mx-2">/</span></li>
          <li><%= link_to category.name, category_path(category), class: "hover:text-gray-700" %></li>
        <% end %>
        <li><span class="mx-2">/</span></li>
        <li class="text-gray-900 font-medium"><%= @category.name %></li>
      </ol>
    </nav>

    <!-- Category Hero -->
    <div class="relative bg-gray-900 rounded-lg overflow-hidden mb-8">
      <% if @category.image.attached? %>
        <%= image_tag @category.image,
            class: "w-full h-64 md:h-80 object-cover opacity-60",
            alt: @category.name %>
      <% else %>
        <div class="w-full h-64 md:h-80 bg-gradient-to-r from-indigo-500 to-purple-600"></div>
      <% end %>

      <div class="absolute inset-0 flex items-center justify-center text-center text-white">
        <div>
          <h1 class="text-4xl md:text-6xl font-bold mb-4"><%= @category.name %></h1>
          <% if @category.description.present? %>
            <p class="text-xl md:text-2xl text-gray-200 max-w-2xl"><%= @category.description %></p>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <!-- Subcategories -->
  <% if @subcategories.any? %>
    <div class="mb-12">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">Shop by Subcategory</h2>

      <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
        <% @subcategories.each do |subcategory| %>
          <%= link_to category_path(subcategory),
              class: "group text-center p-4 bg-white rounded-lg shadow-sm hover:shadow-md transition-all duration-300" do %>
            <% if subcategory.image.attached? %>
              <%= image_tag subcategory.image,
                  class: "w-16 h-16 object-cover rounded-full mx-auto mb-3 group-hover:scale-110 transition-transform duration-300",
                  alt: subcategory.name %>
            <% else %>
              <div class="w-16 h-16 bg-gray-200 rounded-full mx-auto mb-3 flex items-center justify-center group-hover:scale-110 transition-transform duration-300">
                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                </svg>
              </div>
            <% end %>

            <h3 class="font-medium text-gray-900 group-hover:text-indigo-600 transition-colors text-sm">
              <%= subcategory.name %>
            </h3>

            <p class="text-xs text-gray-500 mt-1">
              <%= pluralize(subcategory.products_count, 'item') %>
            </p>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <div class="flex flex-col lg:flex-row gap-8">
    <!-- Sidebar Filters -->
    <div class="w-full lg:w-64 flex-shrink-0">
      <div class="bg-white rounded-lg shadow-sm p-6">
        <%= form_with url: products_path,
            method: :get,
            local: true,
            class: "space-y-6" do |form| %>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Search in <%= @category.name %></label>
            <%= form.text_field :search,
                value: params[:search],
                placeholder: "Search products...",
                class: "form-input w-full" %>
          </div>

          <!-- Category Filter -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
            <%= form.select :category_id,
                options_from_collection_for_select(@categories.roots, :id, :name, params[:category_id]),
                { prompt: 'All Categories' },
                { class: "form-select w-full" } %>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Price Range</label>
            <div class="flex items-center space-x-2">
              <%= form.number_field :min_price,
                  value: params[:min_price],
                  placeholder: "Min",
                  step: 0.01,
                  class: "form-input w-full" %>
              <span class="text-gray-500">to</span>
              <%= form.number_field :max_price,
                  value: params[:max_price],
                  placeholder: "Max",
                  step: 0.01,
                  class: "form-input w-full" %>
            </div>
          </div>

          <div class="flex space-x-2">
            <%= form.submit "Filter", class: "btn btn-primary flex-1" %>
            <%= link_to "Clear", products_path, class: "btn btn-outline-secondary flex-1" %>
          </div>

          <%= form.hidden_field :sort, value: params[:sort] %>

        <% end %>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1">
      <!-- Toolbar -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 bg-white rounded-lg shadow-sm p-4">
        <div class="mb-4 sm:mb-0">
          <p class="text-sm text-gray-600">
            Showing <%= (@products.current_page - 1) * @products.limit_value + 1 %>-<%= [(@products.current_page - 1) * @products.limit_value + @products.limit_value, @products.total_count].min %>
            of <%= @products.total_count %> products
          </p>
        </div>

        <div class="flex items-center space-x-4">
          <label class="text-sm font-medium text-gray-700">Sort by:</label>
          <%= form_with url: category_path(@category),
              method: :get,
              local: true,
              data: { remote: true },
              class: "inline" do |form| %>
            <%= form.select :sort,
                options_for_select([
                  ['Default', ''],
                  ['Price: Low to High', 'price_low'],
                  ['Price: High to Low', 'price_high'],
                  ['Name A-Z', 'name'],
                  ['Newest First', 'newest'],
                  ['Featured', 'featured']
                ], params[:sort]),
                {},
                {
                  class: "form-select",
                  onchange: "this.form.submit()"
                } %>

            <%= form.hidden_field :search, value: params[:search] %>
            <%= form.hidden_field :min_price, value: params[:min_price] %>
            <%= form.hidden_field :max_price, value: params[:max_price] %>
          <% end %>
        </div>
      </div>

      <!-- Products Grid -->
      <div id="products-container">
        <%= render 'products/products_grid', products: @products %>
      </div>
    </div>
  </div>
</div>
